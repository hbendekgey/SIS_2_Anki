# SIS 2 Anki

This repository contains code to generate Anki flash decks from SIS roster pdfs

## Setup: Installing Software

This repository assumes you have:
* Python 3
* Poppler
* The Python packages `camelot` and `pandas`. 

These can be installed on Mac via
```
brew install poppler
pip install camelot-py
pip install pandas
```

## Creating a Deck

The `gen_deck_csv.sh` file can be run to generate your first deck. However, first you must update the line to make sure `ANKI_USERNAME` matches what you see in Anki. If you want to use idphotos in your deck, the images must be stored in a specific directory that depends on the username.

**Usage:**
`./gen_deck_csv.sh <roster_filename.pdf> <target_filename.csv> <Note for students (in quotes)>`

**Example:** `./gen_deck_csv.sh sis_rosters/cs61_25f.pdf decks/fall2025.csv "CS61 Student Fall 2025"`

## Anki Setup

A few changes need to be made in Anki to handle the files generated by this script. 

First, in "Tools > Manage Note Types", create a new type called "Student". Clicking on "Fields" make sure it has the 4 fields "Front", "Back", "ImagePath", and "Id".

Then you can import the notes with "Import File". Make sure the Note Type is Student and the columns are matched properly. 

Finally, in the "Browse" menu, click "Cards..." in the top right, and update the front template to
```
{{Front}}
<br>
<img src={{ImagePath}}>
```

## Exporting Changes from Anki

You can edit your deck manually in the Anki app.

To avoid creating duplicate cards for the same student, I recommend **not** creating independent csv files for import. Instead, you can add a fourth element to `gen_deck_csv.sh` to merge an existing deck with a new SIS roster pdf. This will handle recurring students by adding new notes to their card instead of creating a duplicate card. If you've made changes to the deck in Anki, the first step is to export those in-app changes into a csv file.

Under the "Decks" tab, click the gear next to your deck then "Export". The format you want is "Notes in Plain Text". You don't need to check any boxes. The output will be a .txt file but it is formatted like a csv and can be consumed by `gen_deck_csv.sh`.

## Updating an Anki Deck

Finally, if you want to add new students to your deck, you can use the script `gen_deck_csv.sh` with a fourth argument. This script takes an Anki deck, a SIS roster, and a "note", and:
* Identifies any students (via their ID number) in the roster who are not yet in the deck, and adds them with `Front=<note string>`.
* For the remaining students, adds `\n<note string>` to `Front` *if it is not already present*.

This allows you to track a student across multiple terms, adding notes as they attend more of your classes. 

**Usage:**
`./gen_deck_csv.sh <roster_filename.pdf> <target_filename.csv> '<Note for students>' [deck_filename.csv]`

**Example:** `./gen_deck_csv.sh sis_rosters/cs61_25f.pdf decks/fall2025_updated.csv "CS160 Student Spring 2026" decks/fall2025.csv`

**Notes:** 
* You might consider uploading a roster multiple times as the term progresses because students enroll up until the add deadline. If you do this, you should make sure to use the exact same note string so that you don't double up in adding notes to students enrolled since the beginning.
* I have not yet implemented a "drop" functionality to the script, but if you want to be able to use it, it is important that every roster pdf has a corresponding note. e.g. if Discrete math has 4 rosters (CS-01, CS-02, MATH-01, MATH-02) and you give students in all 4 the same note "CS61 Student Fall 2025" then the drop script will not be able to take a pdf and compare it against the deck to see who has dropped. You will want to create a slightly different note for each roster, e.g. "CS61 Student Fall 2025 9:30am (CS)" or "CS61 Student Fall 2025 10:30am (Math)".

## Identifying When Students Drop

TODO: needs to be added.
